{% set steps = customSteps or [
	{ title: 'Customer Type', description: 'Customer Type' },
	{ title: 'Contact Type', description: 'Contact Type' },
	{ title: 'Choose action', description: 'Choose action' },
	{ title: 'Download to POS', description: 'POS' }
] %}
<!-- begin steps -->
<div class="steps">
	<!-- states: disabled, active, done -->
	<ul class="steps__list">
		{% for item in steps %}
			<li class="steps__item">
				<a href="#" class="steps__in" data-step-state="disabled" data-step="{{loop.index}}">
					<div class="steps__title">{{item.title | safe}}</div>
					<div class="steps__description">{{item.description | safe}}</div>
					<div class="steps__item-circle"></div>
				</a>
			</li>
		{% endfor %}
	</ul>
	<div class="steps__progress">
		<div class="steps__progress-line" data-step="line">
			<div class="steps__progress-in" data-step="in">
				{% for item in steps %}
					<div class="steps__progress-circle"></div>
				{% endfor %}
			</div>
		</div>
	</div>
</div>

<script>
	window.addEventListener('load', () => {
		const defaultActive = {{ step + 1 or 1 }}
		let current = defaultActive;

		const doc = document;
		const steps = Array.from(doc.querySelectorAll('[data-step-state]'));
		const buttons = Array.from(doc.querySelectorAll('[data-step-direction]'));
		const progressLine = doc.querySelector('[data-step="line"]');
		const progressIn = doc.querySelector('[data-step="in"]');
		const max = steps.length;
		const min = 1;
		const percent = 100/max;

		const toggleButtonsState = (state) => buttons.forEach(button => button.disabled = state);
		const setProgress = () => {
			const lineX = `translateX(calc(-${100 - (percent*current - percent/2)}% + 13px))`;
			const inX = `translateX(calc(${100 - (percent*current - percent/2)}% - 13px))`;
			progressLine.style.transform = lineX;
			progressLine.style.webkitTransform = lineX;
			progressIn.style.transform = inX;
			progressIn.style.webkitTransform = inX;
		};

		const setState = () => {
			setProgress();
			steps.forEach((step, i) => {
				const number = +step.dataset.step;
				if (number < current) step.dataset.stepState = 'done';
				if (number > current) step.dataset.stepState = 'disabled';
				if (number === current) step.dataset.stepState = 'active';
			});
		};

		const goTo = {
			next() {
				if (current >= max) return;
				current++;
				setState();
			},
			prev() {
				if (current <= min) return;
				current--;
				setState();
			},
			currentStep(step) {
				current = step;
				setState();
			}
		};

		//go to current step
		buttons.forEach(button => button.addEventListener('click', goTo[button.dataset.stepDirection], false));
		steps.forEach(step => {
			const target = +step.dataset.step;
			step.addEventListener('click', e => {
				e.preventDefault();
				goTo.currentStep(target);
			}, false);
		});
		setState(defaultActive);
	});
</script>
<!-- end steps -->